{"ast":null,"code":"import { useAuth } from 'lib/middleware';\nimport { ok, methodNotAllowed, badRequest } from 'lib/response';\nimport { getRealtimeData } from 'lib/queries';\nimport { parseToken } from 'lib/crypto';\nimport { TOKEN_HEADER } from 'lib/constants';\nexport default (async (req, res) => {\n  await useAuth(req, res);\n\n  if (req.method === 'GET') {\n    const {\n      start_at\n    } = req.query;\n    const token = req.headers[TOKEN_HEADER];\n\n    if (!token) {\n      return badRequest(res);\n    }\n\n    const {\n      websites\n    } = await parseToken(token);\n    const data = await getRealtimeData(websites, new Date(+start_at));\n    return ok(res, data);\n  }\n\n  return methodNotAllowed(res);\n});","map":null,"metadata":{},"sourceType":"module"}