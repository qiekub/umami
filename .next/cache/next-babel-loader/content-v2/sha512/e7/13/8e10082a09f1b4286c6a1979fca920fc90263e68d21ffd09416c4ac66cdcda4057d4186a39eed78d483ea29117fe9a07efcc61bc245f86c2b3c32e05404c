{"ast":null,"code":"import { subMinutes } from 'date-fns';\nimport { useAuth } from 'lib/middleware';\nimport { ok, methodNotAllowed } from 'lib/response';\nimport { getUserWebsites, getRealtimeData } from 'lib/queries';\nimport { createToken } from 'lib/crypto';\nexport default (async (req, res) => {\n  await useAuth(req, res);\n\n  if (req.method === 'GET') {\n    const {\n      user_id\n    } = req.auth;\n    const websites = await getUserWebsites(user_id);\n    const ids = websites.map(({\n      website_id\n    }) => website_id);\n    const token = await createToken({\n      websites: ids\n    });\n    const data = await getRealtimeData(ids, subMinutes(new Date(), 30));\n    return ok(res, {\n      websites,\n      token,\n      data\n    });\n  }\n\n  return methodNotAllowed(res);\n});","map":null,"metadata":{},"sourceType":"module"}