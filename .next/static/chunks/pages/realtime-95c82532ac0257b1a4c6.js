_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[27],{"0tU5":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/realtime",function(){return n("caRh")}])},IA1E:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n("vJKn"),s=n.n(r),a=n("rg98"),i=n("q1tI"),c=n("/MKj"),o=n("j6IE"),u=n("20a2"),l=n("jeBt");function b(){var e=Object(u.useRouter)(),t=Object(c.b)(),n=Object(c.c)((function(e){return e.user})),r=Object(i.useState)(!n),b=r[0],j=r[1],d=Object(i.useState)(n),O=d[0],v=d[1];function f(){return(f=Object(a.a)(s.a.mark((function n(){var r,a,i;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j(!0),n.next=3,Object(l.b)("".concat(e.basePath,"/api/auth/verify"));case 3:if(r=n.sent,a=r.ok,i=r.data,a){n.next=8;break}return n.abrupt("return",e.push("/login"));case 8:return n.next=10,t(Object(o.b)(i));case 10:v(O),j(!1);case 12:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return Object(i.useEffect)((function(){!b&&O||function(){f.apply(this,arguments)}()}),[]),{user:O,loading:b}}},POTn:function(e,t,n){e.exports={metrics:"RealtimeHeader_metrics__3UCe2"}},cNLv:function(e,t,n){e.exports={table:"RealtimeLog_table__2Tl9b",header:"RealtimeLog_header__2LeBZ",row:"RealtimeLog_row__1a7u4",body:"RealtimeLog_body__3dkV9",icon:"RealtimeLog_icon__3aQPX",time:"RealtimeLog_time__PHd3a",website:"RealtimeLog_website__1eqHT",detail:"RealtimeLog_detail__2LyTK",link:"RealtimeLog_link__2ni65"}},caRh:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return we}));var r=n("nKUr"),s=n("q1tI"),a=n("80PL"),i=n("cpVT"),c=n("xvhg"),o=n("kriW"),u=n("/h9T"),l=n("IYaI"),b=n("jIYg");function j(e,t){Object(b.a)(2,arguments);var n=Object(u.a)(t);return Object(l.a)(e,-n)}var d=n("0LOL"),O=n("zsrT"),v=n.n(O),f=n("CUtM"),g=n("FtD2"),m=n("dhJC"),h=n("4+6U"),w=n("sWYD"),p=n("dndX"),x=n("rqNM"),_=n("rIuf"),y=n("YSmr");function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e){var t=0,n=[];return e.reduce((function(e,r){var s=r.created_at,a=Object(d.a)(Object(h.a)(s));return a.getTime()>t?(e={t:Object(w.a)(a,"yyyy-LL-dd HH:mm:00"),y:1},n.push(e),t=a):e.y+=1,e}),{}),n}function E(e){var t=e.data,n=e.unit,a=Object(m.a)(e,["data","unit"]),i=Object(d.a)(new Date),c=j(i,y.n),o=Object(s.useRef)(i),u=Object(s.useMemo)((function(){return t?{pageviews:Object(_.b)(L(t.pageviews),c,i,n),sessions:Object(_.b)(L(t.sessions),c,i,n)}:{pageviews:[],sessions:[]}}),[t]),l=Object(s.useMemo)((function(){return Object(p.a)(o.current,i)?(o.current=i,0):y.c}),[t]);return Object(r.jsx)(x.a,P(P({},a),{},{height:200,unit:n,data:u,animationDuration:l}))}var N,R=n("z7pX"),k=n("dDsW"),C=n("iR1w"),D=n("atwx"),I=n("fFFQ"),S=n("ty6r"),T=n("2K+N"),z=n("ZzUg"),U=n("m/GJ"),V=n("nsFc"),X=n("LAde");function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var K,W=function(e){return s.createElement("svg",H({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},e),N||(N=s.createElement("path",{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"})))};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var B,F=function(e){return s.createElement("svg",A({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},e),K||(K=s.createElement("path",{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"})))};function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var J,q=function(e){return s.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},e),B||(B=s.createElement("path",{d:"M288 144a110.94 110.94 0 00-31.24 5 55.4 55.4 0 017.24 27 56 56 0 01-56 56 55.4 55.4 0 01-27-7.24A111.71 111.71 0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 000-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})))},Y=n("GGPy"),Z=n("cNLv"),Q=n.n(Z),$=(J={},Object(i.a)(J,1,Object(r.jsx)(q,{})),Object(i.a)(J,2,Object(r.jsx)(F,{})),Object(i.a)(J,3,Object(r.jsx)(W,{})),J);function ee(e){var t=e.data,n=e.websites,a=e.websiteId,i=Object(k.a)(),u=Object(V.a)(),l=Object(c.a)(u,1)[0],b=Object(X.a)(l),j=Object(s.useState)(0),d=j[0],O=j[1],f=Object(s.useMemo)((function(){var e=t.pageviews,n=t.sessions,r=t.events,s=[].concat(Object(R.a)(e),Object(R.a)(n),Object(R.a)(r)).sort(v()("created_at",-1));return d?s.filter((function(e){return h(e)===d})):s}),[t,d]),g=Object(s.useMemo)((function(){return t.sessions.reduce((function(e,t){var n=t.session_id,r=t.session_uuid;return e[n]=r,e}),{})}),[t]),m=[{label:Object(r.jsx)(o.a,{id:"label.all",defaultMessage:"All"}),value:0},{label:Object(r.jsx)(o.a,{id:"metrics.views",defaultMessage:"Views"}),value:1},{label:Object(r.jsx)(o.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),value:2},{label:Object(r.jsx)(o.a,{id:"metrics.events",defaultMessage:"Events"}),value:3}];function h(e){var t=e.view_id,n=e.session_id;return e.event_id?3:t?1:n?2:null}function w(e){return $[h(e)]}function p(e){var t=e.website_id;return n.find((function(e){return e.website_id===t}))}function x(e){var t,n=e.event_type,s=e.event_value,a=e.view_id,c=e.session_id,u=e.url,l=e.browser,j=e.os,d=e.country,O=e.device,v=e.website_id;if(n)return Object(r.jsxs)("div",{children:[Object(r.jsx)(I.a,{children:n})," ",s]});if(a){var f,g=null===(f=p({website_id:v}))||void 0===f?void 0:f.domain;return Object(r.jsx)("a",{className:Q.a.link,href:"//".concat(g).concat(u),target:"_blank",rel:"noreferrer noopener",children:u})}return c?Object(r.jsx)(o.a,{id:"message.log.visitor",defaultMessage:"Visitor from {country} using {browser} on {os} {device}",values:{country:Object(r.jsx)("b",{children:b[d]||i.formatMessage({id:"label.unknown",defaultMessage:"Unknown"})}),browser:Object(r.jsx)("b",{children:y.a[l]}),os:Object(r.jsx)("b",{children:j}),device:Object(r.jsx)("b",{children:null===(t=i.formatMessage(U.a[O]))||void 0===t?void 0:t.toLowerCase()})}}):void 0}function M(e){var t=e.created_at;return Object(_.a)(new Date(t),"pp",l)}function P(e){var t=e.session_id;return Object(Y.d)(g[t]||"".concat(t).concat(p(e)))}return Object(r.jsxs)("div",{className:Q.a.table,children:[Object(r.jsx)(T.a,{buttons:m,selected:d,onClick:O}),Object(r.jsx)("div",{className:Q.a.header,children:Object(r.jsx)(o.a,{id:"label.realtime-logs",defaultMessage:"Realtime logs"})}),Object(r.jsxs)("div",{className:Q.a.body,children:[0===(null===f||void 0===f?void 0:f.length)&&Object(r.jsx)(z.a,{}),(null===f||void 0===f?void 0:f.length)>0&&Object(r.jsx)(C.a,{height:400,itemCount:f.length,itemSize:40,children:function(e){var t,s=e.index,i=e.style,c=f[s];return Object(r.jsxs)("div",{className:Q.a.row,style:i,children:[Object(r.jsx)("div",{children:Object(r.jsx)(S.a,{color:P(c)})}),Object(r.jsx)("div",{className:Q.a.time,children:M(c)}),Object(r.jsxs)("div",{className:Q.a.detail,children:[Object(r.jsx)(D.a,{className:Q.a.icon,icon:w(c)}),x(c)]}),!a&&n.length>1&&Object(r.jsx)("div",{className:Q.a.website,children:null===(t=p(c))||void 0===t?void 0:t.domain})]})}})]})]})}var te=n("tfvX"),ne=n("dB/W"),re=n("NgRG"),se=n("POTn"),ae=n.n(se);function ie(e){var t=e.websites,n=e.data,s=e.websiteId,a=e.onSelect,i=[{label:Object(r.jsx)(o.a,{id:"label.all-websites",defaultMessage:"All websites"}),value:0}].concat(t.map((function(e,t){return{label:e.name,value:e.website_id,divider:0===t}}))),c=n.pageviews,u=n.sessions,l=n.events,b=n.countries;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(te.a,{children:[Object(r.jsx)("div",{children:Object(r.jsx)(o.a,{id:"label.realtime",defaultMessage:"Realtime"})}),Object(r.jsx)(ne.a,{value:s,options:i,onChange:a})]}),Object(r.jsxs)("div",{className:ae.a.metrics,children:[Object(r.jsx)(re.a,{label:Object(r.jsx)(o.a,{id:"metrics.views",defaultMessage:"Views"}),value:c.length}),Object(r.jsx)(re.a,{label:Object(r.jsx)(o.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),value:u.length}),Object(r.jsx)(re.a,{label:Object(r.jsx)(o.a,{id:"metrics.events",defaultMessage:"Events"}),value:l.length}),Object(r.jsx)(re.a,{label:Object(r.jsx)(o.a,{id:"metrics.countries",defaultMessage:"Countries"}),value:b.length})]})]})}var ce=n("sjKz"),oe=n("vX6h"),ue=n("GyfN");function le(e){var t=e.websiteId,n=e.data,a=e.websites,i=n.pageviews,c=Object(s.useState)(0),u=c[0],l=c[1],b=Object(s.useMemo)((function(){return a.map((function(e){return e.domain}))}),[a]),j=Object(s.useCallback)((function(e){var t,n;return 1===a.length?null===(t=a[0])||void 0===t?void 0:t.domain:null===(n=a.find((function(t){return t.website_id===e})))||void 0===n?void 0:n.domain}),[a]),d=[{label:Object(r.jsx)(o.a,{id:"metrics.referrers",defaultMessage:"Referrers"}),value:0},{label:Object(r.jsx)(o.a,{id:"metrics.pages",defaultMessage:"Pages"}),value:1}],O=Object(s.useMemo)((function(){return i?[Object(ue.c)(i.reduce((function(e,t){var n=t.referrer;if(null!==n&&void 0!==n&&n.startsWith("http")){var r=new URL(n).hostname.replace(/^www\./,"");if(r&&!b.includes(r)){var s=e.find((function(e){return e.x===r}));s?s.y+=1:e.push({x:r,y:1})}}return e}),[]).sort(v()("y",-1))),Object(ue.c)(i.reduce((function(e,n){var r,s=n.url,i=n.website_id;if(null!==(r=s)&&void 0!==r&&r.startsWith("/")){!t&&a.length>1&&(s="".concat(j(i)).concat(s));var c=e.find((function(e){return e.x===s}));c?c.y+=1:e.push({x:s,y:1})}return e}),[]).sort(v()("y",-1)))]:[]}),[i]),f=O[0],g=O[1];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(T.a,{buttons:d,selected:u,onClick:l}),0===u&&Object(r.jsx)(oe.a,{title:Object(r.jsx)(o.a,{id:"metrics.referrers",defaultMessage:"Referrers"}),metric:Object(r.jsx)(o.a,{id:"metrics.views",defaultMessage:"Views"}),data:f,height:400}),1===u&&Object(r.jsx)(oe.a,{title:Object(r.jsx)(o.a,{id:"metrics.pages",defaultMessage:"Pages"}),metric:Object(r.jsx)(o.a,{id:"metrics.views",defaultMessage:"Views"}),renderLabel:function(e){var n=e.x,s=n.startsWith("/")?j(t):"";return Object(r.jsx)("a",{href:"//".concat(s).concat(n),target:"_blank",rel:"noreferrer noopener",children:n})},data:g,height:400})]})}var be=n("0Kmt"),je=n("j6bx"),de=n.n(je);function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fe(e,t,n){var r=e.map((function(e){return e.__id}));return e.concat(t.filter((function(e){var t=e.__id;return!r.includes(t)}))).filter((function(e){var t=e.created_at;return new Date(t).getTime()>=n}))}function ge(e,t){return e.filter((function(e){return e.website_id===t}))}function me(){var e,t=Object(V.a)(),n=Object(c.a)(t,1)[0],a=Object(X.a)(n),u=Object(s.useState)(),l=u[0],b=u[1],O=Object(s.useState)(0),m=O[0],h=O[1],w=Object(be.a)("/api/realtime/init"),p=w.data,x=w.loading,_=Object(be.a)("/api/realtime/update",{params:{start_at:null===l||void 0===l?void 0:l.timestamp},disabled:!(null!==p&&void 0!==p&&null!==(e=p.websites)&&void 0!==e&&e.length)||!l,interval:y.m,headers:Object(i.a)({},y.r,null===p||void 0===p?void 0:p.token)}).data,M=Object(s.useCallback)((function(e){var t=e.x;return Object(r.jsx)("span",{className:n,children:a[t]})}),[a]),P=Object(s.useMemo)((function(){if(l){var e=l.pageviews,t=l.sessions,n=l.events;if(m)return{pageviews:ge(e,m),sessions:ge(t,m),events:ge(n,m)}}return l}),[l,m]),L=Object(s.useMemo)((function(){return null!==P&&void 0!==P&&P.sessions?Object(ue.c)(P.sessions.reduce((function(e,t){var n=t.country;if(n){var r=e.find((function(e){return e.x===n}));r?r.y+=1:e.push({x:n,y:1})}return e}),[]).sort(v()("y",-1))):[]}),[null===P||void 0===P?void 0:P.sessions]);if(Object(s.useEffect)((function(){if(p&&!l){var e=p.websites,t=p.data;b(ve({websites:e},t))}}),[p]),Object(s.useEffect)((function(){if(_){var e=_.pageviews,t=_.sessions,n=_.events,r=_.timestamp,s=j(Object(d.a)(new Date),y.n).getTime();b((function(a){return ve(ve({},a),{},{pageviews:fe(a.pageviews,e,s),sessions:fe(a.sessions,t,s),events:fe(a.events,n,s),timestamp:r})}))}}),[_]),!p||!l||x)return null;var N=l.websites;return Object(r.jsxs)(f.a,{children:[Object(r.jsx)(ie,{websites:N,websiteId:m,data:ve(ve({},P),{},{countries:L}),onSelect:h}),Object(r.jsx)("div",{className:de.a.chart,children:Object(r.jsx)(E,{websiteId:m,data:P,unit:"minute",records:y.n})}),Object(r.jsxs)(g.c,{children:[Object(r.jsxs)(g.b,{children:[Object(r.jsx)(g.a,{xs:12,lg:4,children:Object(r.jsx)(le,{websiteId:m,data:P,websites:N})}),Object(r.jsx)(g.a,{xs:12,lg:8,children:Object(r.jsx)(ee,{websiteId:m,data:P,websites:N})})]}),Object(r.jsxs)(g.b,{children:[Object(r.jsx)(g.a,{xs:12,lg:4,children:Object(r.jsx)(oe.a,{title:Object(r.jsx)(o.a,{id:"metrics.countries",defaultMessage:"Countries"}),metric:Object(r.jsx)(o.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),data:L,renderLabel:M,height:500})}),Object(r.jsx)(g.a,{xs:12,lg:8,children:Object(r.jsx)(ce.a,{data:L})})]})]})]})}var he=n("IA1E");function we(){return Object(he.a)().loading?null:Object(r.jsx)(a.a,{children:Object(r.jsx)(me,{})})}},j6IE:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n("i7Pf"),s=Object(r.b)({name:"user",initialState:null,reducers:{updateUser:function(e,t){return t.payload}}}),a=s.actions.updateUser;t.a=s.reducer},j6bx:function(e,t,n){e.exports={container:"RealtimeDashboard_container__1ZLx1",chart:"RealtimeDashboard_chart__1LaXv"}}},[["0tU5",0,2,6,8,11,1,3,4,5,7,12,15]]]);